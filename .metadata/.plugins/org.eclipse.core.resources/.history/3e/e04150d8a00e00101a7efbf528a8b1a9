package com.project.service;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Random;
import java.util.UUID;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.server.ResponseStatusException;

import com.project.config.JwtUtil;
import com.project.mapper.InquiryMapper;
import com.project.mapper.UserMapper;
import com.project.model.Favorite;
import com.project.model.Favorites;
import com.project.model.Inquiry;
import com.project.model.Notification;
import com.project.model.User;
import com.project.model.krhBoardVO;

import lombok.RequiredArgsConstructor;


@Service
@Transactional
@RequiredArgsConstructor
public class UserService {

    private final UserMapper userMapper;
    private final JwtUtil jwtUtil;
    private final PasswordEncoder passwordEncoder;
    private final InquiryMapper inquiryMapper;
    // ğŸ”¹ ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ ì €ì¥
    private final Map<String, String> verificationCodes = new HashMap<>(); // ğŸ”¹ ì´ë©”ì¼-ì½”ë“œ ì €ì¥
    private final EmailService emailService;
    private static final String UPLOAD_DIR = System.getProperty("user.dir") + "/uploads/"; // âœ… ì—…ë¡œë“œ ë””ë ‰í† ë¦¬ ê³ ì •
    private final JdbcTemplate jdbcTemplate;

    @Autowired
    public UserService(EmailService emailService,
                       InquiryMapper inquiryMapper,
                       JwtUtil jwtUtil,
                       PasswordEncoder passwordEncoder,
                       UserMapper userMapper,
                       JdbcTemplate jdbcTemplate) {  // ğŸ”¹ JdbcTemplate ì¶”ê°€
        this.emailService = emailService;
        this.inquiryMapper = inquiryMapper;
        this.jwtUtil = jwtUtil;
        this.passwordEncoder = passwordEncoder;
        this.userMapper = userMapper;
        this.jdbcTemplate = jdbcTemplate; // ğŸ”¹ ì¶”ê°€ëœ jdbcTemplate
    }
    // âœ… ì¸ì¦ë²ˆí˜¸ ìƒì„± í›„ ì €ì¥
    public void sendVerificationEmail(String email) {
        String code = generateVerificationCode(); // ëœë¤ ì¸ì¦ë²ˆí˜¸ ìƒì„±
        userMapper.saveVerificationCode(email, code); // DBì— ì €ì¥
        emailService.sendEmail(email, "ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ", "ì¸ì¦ë²ˆí˜¸: " + code);
    }

    public void verifyEmail(String email, String code) { // âœ… ë³€ê²½: verificationCode -> code
        String storedCode = userMapper.getVerificationCode(email);
        
        System.out.println("ì…ë ¥ëœ ì¸ì¦ë²ˆí˜¸: " + code);
        System.out.println("DBì— ì €ì¥ëœ ì¸ì¦ë²ˆí˜¸: " + storedCode);

        if (storedCode == null) {
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "ì¸ì¦ë²ˆí˜¸ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }

        if (!storedCode.trim().equals(code.trim())) {  // âœ… trim()ì„ ì‚¬ìš©í•˜ì—¬ ê³µë°± ë¬¸ì œ í•´ê²°
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }

        System.out.println("âœ… ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.");
    }





    // âœ… 6ìë¦¬ ëœë¤ ì¸ì¦ë²ˆí˜¸ ìƒì„±
    private String generateVerificationCode() {
        Random random = new Random();
        return String.format("%06d", random.nextInt(1000000)); // 6ìë¦¬ ìˆ«ìë¡œ ë³€í™˜
    }
    public void registerUser(User user, MultipartFile profileImage) {
        if (user.getIsVerified() == null || !user.getIsVerified()) {
            throw new ResponseStatusException(HttpStatus.FORBIDDEN, "ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•œ ì‚¬ìš©ìë§Œ ê°€ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        }

        user.setIsVerified(true);

        // âœ… ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”
        String encryptedPassword = passwordEncoder.encode(user.getPassword());
        user.setPassword(encryptedPassword);

        // âœ… í”„ë¡œí•„ ì´ë¯¸ì§€ ì €ì¥ ì²˜ë¦¬
        if (profileImage != null && !profileImage.isEmpty()) {
            try {
                String uploadDir = System.getProperty("user.dir") + "/uploads/";
                File folder = new File(uploadDir);
                if (!folder.exists()) folder.mkdirs();

                String originalFileName = profileImage.getOriginalFilename();
                String newFileName = UUID.randomUUID() + "_" + originalFileName;

                File dest = new File(uploadDir + newFileName);
                profileImage.transferTo(dest);

                user.setProfileImage(newFileName);
                System.out.println("ğŸ“¸ ì´ë¯¸ì§€ ì €ì¥ ì™„ë£Œ: " + newFileName);
            } catch (IOException e) {
                throw new ResponseStatusException(HttpStatus.INTERNAL_SERVER_ERROR, "í”„ë¡œí•„ ì´ë¯¸ì§€ ì €ì¥ ì‹¤íŒ¨");
            }
        }

        userMapper.registerUser(user);
        System.out.println("âœ… íšŒì›ê°€ì… ì™„ë£Œ!");
    }



    // âœ… ì´ë©”ì¼ ì¤‘ë³µ ì²´í¬ ì„œë¹„ìŠ¤
    public boolean checkEmailExists(String email) {
        return userMapper.checkEmailExists(email) > 0;
    }
    // âœ… íœ´ëŒ€í° ë²ˆí˜¸ ì¤‘ë³µ ì²´í¬ ì„œë¹„ìŠ¤
 // âœ… íœ´ëŒ€í° ë²ˆí˜¸ ì¤‘ë³µ ì²´í¬ ì„œë¹„ìŠ¤ (ìˆ˜ì •)
    public boolean checkPhoneExists(String phoneNumber) {
        // âœ… DBì—ì„œ í•˜ì´í”ˆ ì œê±° í›„ ë¹„êµí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì¤‘ë³µ ê²€ì‚¬
        int count = userMapper.countByPhoneNumber(phoneNumber);
        return count > 0; // 0ë³´ë‹¤ í¬ë©´ ì¤‘ë³µ
    }


    // âœ… 1. ğŸ”¹ ì´ë¦„ê³¼ íœ´ëŒ€í° ë²ˆí˜¸ë¡œ ì•„ì´ë””(ì´ë©”ì¼) ì°¾ê¸° (ë³€ê²½)
    public String findUserIdByNameAndPhone(String name, String phoneNumber) {
        String userEmail = userMapper.findEmailByNameAndPhone(name, phoneNumber);
        if (userEmail == null) {
            throw new IllegalArgumentException("ì…ë ¥í•œ ì •ë³´ì™€ ì¼ì¹˜í•˜ëŠ” ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.");
        }
        return userEmail;
    }

 // âœ… 2. ğŸ”¹ ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°: ì´ë©”ì¼ ì¸ì¦ ì½”ë“œ ì „ì†¡ (ì´ë©”ì¼ + íœ´ëŒ€í° ë²ˆí˜¸ í™•ì¸)
    public void sendVerificationCode(String email, String phoneNumber) {
        if (userMapper.countUserByEmailAndPhone(email, phoneNumber) == 0) {
            throw new IllegalArgumentException("í•´ë‹¹ ì´ë©”ì¼ê³¼ íœ´ëŒ€í° ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ëŠ” ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }

        String verificationCode = emailService.generateVerificationCode();
        System.out.println("ğŸ“Œ ìƒì„±ëœ ì¸ì¦ë²ˆí˜¸: " + verificationCode);
        
        // ğŸ”¹ DBì—ì„œ ê¸°ì¡´ ì½”ë“œ ì¡°íšŒ
        String existingCode = userMapper.getVerificationCode(email);

        if (existingCode == null) {
            System.out.println("ğŸ“Œ ê¸°ì¡´ ì¸ì¦ë²ˆí˜¸ ì—†ìŒ, INSERT ì‹¤í–‰");
            userMapper.saveVerificationCode(email, verificationCode);
        } else {
            System.out.println("ğŸ“Œ ê¸°ì¡´ ì¸ì¦ë²ˆí˜¸ ì¡´ì¬, UPDATE ì‹¤í–‰");
            int updatedRows = userMapper.updateVerificationCode(email, verificationCode);

            if (updatedRows == 0) {
                System.out.println("ğŸ“Œ UPDATE ì‹¤íŒ¨, INSERT ì‹¤í–‰");
                userMapper.saveVerificationCode(email, verificationCode);
            }
        }

        System.out.println("âœ… ì¸ì¦ë²ˆí˜¸ ì €ì¥ë¨: " + verificationCode);
        emailService.sendVerificationCode(email, verificationCode);
    }


    // âœ… 3. ğŸ”¹ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ì´ë©”ì¼ + íœ´ëŒ€í° ë²ˆí˜¸ í™•ì¸ í›„)
    public void resetPassword(String email, String newPassword) {
        System.out.println("âœ… ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ìš”ì²­ - ì´ë©”ì¼: " + email);

        // ğŸ”¹ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” í›„ ì €ì¥
        String encryptedPassword = passwordEncoder.encode(newPassword);
        userMapper.updatePassword(email, encryptedPassword);

        System.out.println("âœ… ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì™„ë£Œ!");
    }
    


    // ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¡œ ìœ ì € ê²€ì¦
    public User validateUser(String email, String rawPassword) {
        User user = userMapper.getUserByEmail(email);
        if (user == null) {
            return null;
        }

        System.out.println("ğŸ” [ë°±ì—”ë“œ] ë¡œê·¸ì¸ ìš”ì²­ - ì´ë©”ì¼: " + email);
        System.out.println("ğŸ”¹ [ë°±ì—”ë“œ] ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ëœ í•´ì‹œ ë¹„ë°€ë²ˆí˜¸: " + user.getPassword());
        System.out.println("ğŸ”¹ [ë°±ì—”ë“œ] ì…ë ¥ëœ ì›ë³¸ ë¹„ë°€ë²ˆí˜¸: " + rawPassword);

        // âœ… bcryptë¡œ ë¹„ë°€ë²ˆí˜¸ ë¹„êµ
        if (!passwordEncoder.matches(rawPassword, user.getPassword())) {
            System.out.println("ğŸš¨ [ë°±ì—”ë“œ] ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜!");
            return null;
        }

        return user;
    }

 // UserService í´ë˜ìŠ¤ ë‚´ë¶€ì— ì¶”ê°€
    public String getHashedPasswordByEmail(String email) {
        return userMapper.getHashedPasswordByEmail(email);
    }

    public Map<String, Object> login(String email, String rawPassword) {
        System.out.println("ğŸš€ login() ë©”ì„œë“œ ì‹¤í–‰ë¨! ì…ë ¥ëœ ì´ë©”ì¼: " + email);

        // ğŸ”¹ 1. ìœ ì € ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        User user = userMapper.getUserByEmail(email);
        System.out.println("ğŸ” [DB ì¡°íšŒ ê²°ê³¼] user = " + (user != null ? "ì¡´ì¬í•¨" : "ì¡´ì¬í•˜ì§€ ì•ŠìŒ"));

        if (user == null) {
            System.out.println("âŒ ì´ë©”ì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ");
            throw new ResponseStatusException(HttpStatus.UNAUTHORIZED, "ì˜ëª»ëœ ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.");
        }

        System.out.println("ğŸ” [DB ì €ì¥ëœ í•´ì‹œ ë¹„ë²ˆ] " + user.getPassword());
        System.out.println("ğŸ” [ì…ë ¥ëœ ì›ë³¸ ë¹„ë²ˆ] " + rawPassword);

        if (!passwordEncoder.matches(rawPassword, user.getPassword())) {
            System.out.println("âŒ ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜");
            throw new ResponseStatusException(HttpStatus.UNAUTHORIZED, "ì˜ëª»ëœ ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ì…ë‹ˆë‹¤.");
        }

        System.out.println("âœ… ë¡œê·¸ì¸ ì„±ê³µ! ìœ ì € ID: " + user.getId() + ", ì—­í• : " + user.getRole());

        // ğŸ”¹ 2. ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥ (ê´€ë¦¬ì ì œì™¸)
        if (user.getId() != null && !"ADMIN".equals(user.getRole())) {
            System.out.println("ğŸ”¹ saveLoginHistory() í˜¸ì¶œ ì˜ˆì • - userId: " + user.getId());
            saveLoginHistory(user.getId());
            System.out.println("âœ… ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥ ì™„ë£Œ!");
        } else {
            System.out.println("âš ï¸ ê´€ë¦¬ì ë˜ëŠ” ID NULL â†’ ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥ ì œì™¸");
        }

        // ğŸ”¹ 3. ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì‹œê°„ ì—…ë°ì´íŠ¸ (ëª¨ë‘ ì ìš©)
        userMapper.updateLastLogin(user.getId());
        System.out.println("âœ… last_login ì»¬ëŸ¼ ì—…ë°ì´íŠ¸ ì™„ë£Œ");

        // ğŸ”¹ 4. login_count ì¦ê°€ (ê´€ë¦¬ì ì œì™¸)
        if (!"ADMIN".equals(user.getRole())) {
            userMapper.incrementLoginCount(email);
            System.out.println("âœ… ì¼ë°˜ ìœ ì € login_count ì¦ê°€ ì™„ë£Œ (1ì‹œê°„ ê°„ê²© ì œí•œ)");
        } else {
            System.out.println("âš ï¸ ê´€ë¦¬ì ë¡œê·¸ì¸ â†’ login_count ì¦ê°€ ì œì™¸");
        }

        // ğŸ”¹ 5. JWT ìƒì„±
        String token = jwtUtil.generateToken(user.getEmail(), user.getRole());
        System.out.println("âœ… JWT í† í° ìƒì„± ì™„ë£Œ: " + token);

        // ğŸ”¹ 6. ì‘ë‹µ êµ¬ì„±
        Map<String, Object> response = new HashMap<>();
        response.put("user", user);
        response.put("token", token);

        return response;
    }


    
    public void saveLoginHistory(Long userId) {
        System.out.println("ğŸ“ saveLoginHistory() ì‹¤í–‰ë¨! userId = " + userId);
        if (userId == null) {
            System.out.println("âš ï¸ userIdê°€ NULLì´ë¼ ê¸°ë¡ì´ ì•ˆ ë¨!");
            return;
        }

        try {
            String sql = "INSERT INTO login_history (user_id) VALUES (?)";
            jdbcTemplate.update(sql, userId);
            System.out.println("âœ… ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥ ì™„ë£Œ! userId = " + userId);
        } catch (Exception e) {
            System.out.println("âŒ ë¡œê·¸ì¸ ê¸°ë¡ ì €ì¥ ì¤‘ ì˜ˆì™¸ ë°œìƒ: " + e.getMessage());
            e.printStackTrace();
        }
    }




    public User getUserByEmail(String email) {
        System.out.println("ğŸ” getUserByEmail() ì‹¤í–‰ë¨: " + email);
        User user = userMapper.getUserByEmail(email);

        if (user == null) {
            System.out.println("âš  ìœ ì €ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ!");
            throw new IllegalArgumentException("í•´ë‹¹ ì´ë©”ì¼ì˜ ìœ ì €ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }

        System.out.println("âœ… ì¡°íšŒëœ ìœ ì €: " + user);

        // âœ… í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€í™˜ ë¡œì§ (ì¤‘ë³µ ë³€í™˜ ë°©ì§€)
        String profileImage = user.getProfileImage();
        if (profileImage != null && !profileImage.isEmpty()) {
            profileImage = profileImage.trim();

            // âš  URLì— `http://localhost:8080/uploads/`ê°€ í¬í•¨ëœ ê²½ìš°, ë³€í™˜í•˜ì§€ ì•ŠìŒ
            if (!profileImage.startsWith("http://") && !profileImage.startsWith("https://")) {
                profileImage = "http://localhost:8080/uploads/" + profileImage;
                System.out.println("ğŸ–¼ ë³€í™˜ëœ í”„ë¡œí•„ ì´ë¯¸ì§€ URL: " + profileImage);
            } else {
                System.out.println("ğŸ–¼ ê¸°ì¡´ URL ìœ ì§€: " + profileImage);
            }

            user.setProfileImage(profileImage);
        } else {
            System.out.println("âš  í”„ë¡œí•„ ì´ë¯¸ì§€ ì—†ìŒ!");
        }

        return user;
    }






    // ğŸ”¹ 2ï¸âƒ£ ìœ ì € ì •ë³´ ìˆ˜ì • + ì´ë¯¸ì§€ ì—…ë¡œë“œ
    @Transactional
    public User updateUser(String email, String password, String name, String phoneNumber, MultipartFile file) {
        User user = userMapper.findByEmail(email);
        if (user == null) {
            throw new RuntimeException("ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }

        if (password != null && !password.isEmpty()) {
            user.setPassword(passwordEncoder.encode(password));
        }
        user.setName(name);
        user.setPhoneNumber(phoneNumber);

        // âœ… í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
        if (file != null && !file.isEmpty()) {
            String newFileName = UUID.randomUUID() + "_" + file.getOriginalFilename();
            Path filePath = Paths.get(System.getProperty("user.dir") + "/uploads/", newFileName);

            try {
                Files.createDirectories(Paths.get(System.getProperty("user.dir") + "/uploads/")); // âœ… ë””ë ‰í† ë¦¬ ì—†ìœ¼ë©´ ìƒì„±
                file.transferTo(filePath.toFile());
                user.setProfileImage(newFileName);
                System.out.println("âœ… ì €ì¥ëœ íŒŒì¼ ê²½ë¡œ: " + filePath.toAbsolutePath());
            } catch (IOException e) {
                throw new RuntimeException("âŒ íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨: " + e.getMessage(), e);
            }
        }

        userMapper.updateUser(user);
        return user; // âœ… ì—…ë°ì´íŠ¸ëœ ìœ ì € ê°ì²´ ë°˜í™˜
    }




    

    public List<krhBoardVO> getUserBoardTitles(String email) {
        System.out.println("ğŸŸ¢ [ê²Œì‹œë¬¼ ì¡°íšŒ ìš”ì²­] email: " + email);
        return userMapper.findBoardsByUserEmail(email);
    }

    // ğŸ”¹ íšŒì›íƒˆí‡´ ìš”ì²­ ì €ì¥
    public void requestAccountDeletion(String email, String reason) {
        userMapper.requestAccountDeletion(email, reason);
    }

    // ğŸ”¹ (ë³¸ì¸) ìœ ì € ì•Œë¦¼ ëª©ë¡ ì¡°íšŒ
    public List<Notification> getUserNotifications(String email) {
        return userMapper.getUserNotifications(email);
    }

    // ğŸ”¹ (ë³¸ì¸) ìœ ì € ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬
    public void markUserNotificationAsRead(Long notificationId, String email) {
        userMapper.markUserNotificationAsRead(notificationId, email);
    }
    // âœ… íŠ¹ì • ì•Œë¦¼ ì‚­ì œ
    public void deleteUserNotification(Long id) {
        userMapper.deleteUserNotification(id);
    }

    /** âœ… ìœ ì € ì¦ê²¨ì°¾ê¸° ê´€ë ¨ ê¸°ëŠ¥ **/

    // ìœ ì €ì˜ ì¦ê²¨ì°¾ê¸° ëª©ë¡ ì¡°íšŒ
    public List<Favorites> getFavoritesByUser(Long userId) {
        return userMapper.getFavoritesByUserId(userId);
    }
    public List<Map<String, Object>> getFavoriteRecipeList(Long userId) {
        return userMapper.getFavoriteRecipesByUser(userId);
    }

    // ì¦ê²¨ì°¾ê¸° ì‚­ì œ
    @Transactional
    public boolean removeFavorite(Long userId, Long recipeId) {
        int deletedRows = userMapper.removeFavorite(userId, recipeId);

        if (deletedRows > 0) {
            System.out.println("âœ… [ì„±ê³µ] ê´€ì‹¬ ëª©ë¡ì—ì„œ ì‚­ì œë¨! (ì‚­ì œëœ í–‰ ìˆ˜: " + deletedRows + ")");
            return true;
        } else {
            System.out.println("âŒ [ì‹¤íŒ¨] ì‚­ì œëœ ë°ì´í„° ì—†ìŒ! userId ë˜ëŠ” recipeId í™•ì¸ í•„ìš”");
            return false;
        }
    }
    // ğŸ”¹ 1:1 ë¬¸ì˜ ë“±ë¡
    public void insertInquiry(Inquiry inquiry) {
        userMapper.insertInquiry(inquiry);
    }

 // ğŸ”¹ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ ë¬¸ì˜ ëª©ë¡ ì¡°íšŒ
    public List<Inquiry> getUserInquiries(String email) {
        return inquiryMapper.getUserInquiries(email);
    }
 // âœ… íŠ¹ì • ë¬¸ì˜ê°€ í•´ë‹¹ ì‚¬ìš©ìì˜ ê²ƒì¸ì§€ í™•ì¸í•˜ëŠ” ë©”ì„œë“œ (ê¸°ì¡´ `getUserInquiries` í™œìš©)
    public boolean isInquiryOwner(Long inquiryId, String email) {
        return getUserInquiries(email).stream()
            .anyMatch(inquiry -> inquiry.getId().equals(inquiryId));
    }
 // âœ… íŠ¹ì • ë¬¸ì˜ ì¡°íšŒ ì„œë¹„ìŠ¤
    public Inquiry getInquiryById(Long id) {
        return inquiryMapper.findById(id);
    }

    // ğŸ”¹ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ íŠ¹ì • ë¬¸ì˜ ì‚­ì œ
    public void deleteInquiry(Long id, String email) {
        Inquiry inquiry = inquiryMapper.findById(id);

        if (inquiry == null) {
            throw new ResponseStatusException(HttpStatus.NOT_FOUND, "ë¬¸ì˜ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        }

        // **ì´ë©”ì¼ ë¹„êµ ë¶ˆí•„ìš” -> JWTì—ì„œ ì¶”ì¶œí•œ ì´ë©”ì¼ê³¼ ë™ì¼í•œ ë°ì´í„°ë§Œ ì¡°íšŒ**
        inquiryMapper.deleteInquiry(id);
    }
}